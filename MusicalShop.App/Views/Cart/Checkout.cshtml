@model MusicalShop.Web.InputModels.Checkout.CheckoutInputModel
@inject IOptions<MusicalShop.App.Stripe.StripeSettings> Stripe
@{
    ViewData["Title"] = "Checkout";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var price = ViewData["price"];
}

<div class="cart-table-area section-padding-100">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 col-lg-8">
                <div class="checkout_details_area mt-50 clearfix">

                    <div class="cart-title">
                        <h2>Checkout</h2>
                    </div>

                    <form asp-action="Checkout" asp-controller="Checkout" method="post">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" id="first_name" asp-for="@Model.FirstName" placeholder="First Name" required>
                                <span asp-validation-for="@Model.FirstName"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" id="last_name" asp-for="@Model.LastName" placeholder="Last Name" required>
                                <span asp-validation-for="@Model.LastName"></span>
                            </div>
                            <div class="col-12 mb-3">
                                <input type="text" class="form-control" id="company" placeholder="Company Name" asp-for="@Model.CompanyName">
                                <span asp-validation-for="@Model.CompanyName"></span>
                            </div>
                            <div class="col-12 mb-3">
                                <input type="email" class="form-control" id="email" placeholder="Email" asp-for="@Model.Email">
                                <span asp-validation-for="@Model.Email"></span>
                            </div>
                            <div class="col-12 mb-3">
                                <input type="text" class="form-control mb-3" id="street_address" placeholder="Address" asp-for="@Model.Address">
                                <span asp-validation-for="@Model.Address"></span>
                            </div>
                            <div class="col-12 mb-3">
                                <input type="text" class="form-control" id="city" placeholder="Town" asp-for="@Model.Town">
                                <span asp-validation-for="@Model.Town"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <input type="text" class="form-control" id="zipCode" placeholder="Zip Code" asp-for="@Model.ZipCode">
                                <span asp-validation-for="@Model.ZipCode"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <input type="number" class="form-control" id="phone_number" min="0" placeholder="Phone No" asp-for="@Model.PhoneNumber">
                                <span asp-validation-for="@Model.PhoneNumber"></span>
                            </div>
                            <div class="col-12 mb-3">
                                <textarea name="comment" asp-for="@Model.Comment" class="form-control w-100" id="comment" cols="30" rows="10" placeholder="Leave a comment about your order"></textarea>
                                <span asp-validation-for="@Model.Comment"></span>
                            </div>

                            <div class="col-12">
                                <div class="custom-control custom-checkbox d-block mb-2">
                                    <input type="checkbox" class="custom-control-input" id="customCheck2">
                                    <label class="custom-control-label" for="customCheck2">Create an accout</label>
                                </div>
                                <div class="custom-control custom-checkbox d-block">
                                    <input type="checkbox" class="custom-control-input" id="customCheck3">
                                    <label class="custom-control-label" for="customCheck3">Ship to a different address</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <div class="cart-summary">
                    <h5>Cart Total</h5>
                    <ul class="summary-table">
                        <li><span>subtotal:</span><span>$@price</span></li>
                        <li><span>delivery:</span><span>Free</span></li>
                        <li><span>total:</span><span>$@price</span></li>
                    </ul>
                 
                        <script src="//checkout.stripe.com/v2/checkout.js"
                        class="stripe-button"
                        data-key="@Stripe.Value.PublishableKey"
                        data-locale="auto"
                        data-description="Payment"
                        data-amount="@price">
                        </script>
                    </div>

                    <div class="cart-btn mt-100">
                        <a href="#" class="btn amado-btn w-100">Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*<script>
    $(document).ready(function () {
        var stripe = Stripe("pk_test_51Ist4WFPBTAeKUUDPhqaQyomNaHARHkHwDCvQ1RReZ1XaeYqnw1JF6AVmjOgr9rneLbHXmpsP2RFW8AoiZ4FdBg400qdXr81Vd"));
    var elements = stripe.elements();

    var style = {
        base: 'lineHeight': '1.35',
        'font-size': '1.11rem',
        'color': '#495057',
        'fontFamily': 'apple-system, BlinkMacSystemFont, "Sageo UI", Roboto, "Helvetica Neue",Arial, sans-serif'
    }

    var card = elements.create('carNumber', {
        'placeholder': '',
        'style': style
    });
    cvc.mount('#card-cvc');

    var exp = elements.create('cardExpiry', {
        'placeholder': '',
        'style': style
    });
    exp.mount('#card-exp');

    var form = document.getElementById('payment-form');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        stripe.createToken(card).then(function (event){
            event.preventDefault();
            stripe.createToken(card).then(function (result) {
                if (result.error) {
                    var errorElement = document.getElementById('card-errors');
                    errorElement.textContent = result.error.message;
                }
                else {
                    stripeTokenHandler(result.token);
                    console.log(result.token);
                }
            });
        });

        function stripeTokenHandler(token) {
            $(".StripeToken").val(token.id);

            form.submit();
        }
</script>*@